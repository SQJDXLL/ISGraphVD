int __fastcall set_dns_listeners(time_t now)
{
  unsigned int v2; // $v0
  int v3; // $s4
  tftp_transfer *i; // $s1
  serverfd *j; // $s1
  dnsmasq_daemon *v6; // $v0
  listener *k; // $s1
  int osport; // $s1
  char *v10; // $v0
  int tcpfd; // $a0
  dnsmasq_daemon *tcp_pids; // $v0
  auth_zone *auth_zones; // $a1
  dnsmasq_daemon *v14; // $v0
  int tftpfd; // $a0
  int m; // $s1
  int v17; // $a0
  int wait; // [sp+18h] [-8h] BYREF

  v2 = dnsmasq_daemon_0->options[1] & 0x10000000;
  wait = 0;
  v3 = 0;
  if ( !v2 )
  {
    for ( i = dnsmasq_daemon_0->tftp_trans; i; i = i->next )
    {
      poll_listen(i->sockfd, 1);
      ++v3;
    }
  }
  if ( dnsmasq_daemon_0->port )
    get_new_frec(now, &wait, 0);
  for ( j = dnsmasq_daemon_0->sfds; j; j = j->next )
    poll_listen(j->fd, 1);
  if ( !dnsmasq_daemon_0->port || (osport = dnsmasq_daemon_0->osport) != 0 )
  {
    v6 = dnsmasq_daemon_0;
  }
  else
  {
    do
    {
      v10 = (char *)dnsmasq_daemon_0 + 8 * osport;
      if ( *((_WORD *)v10 + 402) )
        poll_listen(*((_DWORD *)v10 + 200), 1);
      ++osport;
    }
    while ( osport != 64 );
    v6 = dnsmasq_daemon_0;
  }
  for ( k = v6->listeners; k; k = k->next )
  {
    if ( k->fd != -1 && !wait )
      poll_listen(k->fd, 1);
    tcpfd = k->tcpfd;
    if ( tcpfd == -1 )
    {
LABEL_29:
      v14 = dnsmasq_daemon_0;
    }
    else
    {
      tcp_pids = (dnsmasq_daemon *)dnsmasq_daemon_0->tcp_pids;
      do
      {
        if ( tcp_pids->options[0] )
        {
          tcp_pids = (dnsmasq_daemon *)((char *)tcp_pids + 4);
        }
        else
        {
          auth_zones = tcp_pids->auth_zones;
          tcp_pids = (dnsmasq_daemon *)((char *)tcp_pids + 4);
          if ( auth_zones == (auth_zone *)-1 )
          {
            poll_listen(tcpfd, 1);
            goto LABEL_29;
          }
        }
      }
      while ( dnsmasq_daemon_0->tcp_pipes != (int *)tcp_pids );
      v14 = dnsmasq_daemon_0;
    }
    if ( v14->tftp_max >= v3 )
    {
      tftpfd = k->tftpfd;
      if ( tftpfd != -1 )
        poll_listen(tftpfd, 1);
    }
  }
  if ( (dnsmasq_daemon_0->options[0] & 0x40) == 0 )
  {
    for ( m = 0; m != 20; ++m )
    {
      v17 = dnsmasq_daemon_0->tcp_pipes[m];
      if ( v17 != -1 )
        poll_listen(v17, 1);
    }
  }
  return wait;
}
