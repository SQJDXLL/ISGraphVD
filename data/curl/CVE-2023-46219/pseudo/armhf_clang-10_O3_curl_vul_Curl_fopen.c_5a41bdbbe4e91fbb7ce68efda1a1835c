CURLcode __fastcall Curl_fopen(Curl_easy *data, const char *filename, FILE **fh, char **tempname)
{
  char *v6; // r5
  __mode_t v9; // r10
  int v10; // r0
  CURLcode v11; // r7
  FILE *v12; // r0
  int v14; // r0
  int v15; // r0
  int v16; // r9
  FILE *v17; // r0
  _DWORD v18[26]; // [sp+0h] [bp-100h] BYREF
  char v19[16]; // [sp+68h] [bp-98h] BYREF
  __mode_t v20; // [sp+78h] [bp-88h]
  int v21; // [sp+80h] [bp-80h]
  int v22; // [sp+84h] [bp-7Ch]
  unsigned __int8 randsuffix[9]; // [sp+D7h] [bp-29h] BYREF

  v6 = 0;
  *tempname = 0;
  if ( stat64(filename, v19) == -1 || (v9 = v20, (v20 & 0xF000) != 0x8000) )
  {
    v12 = (FILE *)fopen64(filename, "w");
    *fh = v12;
    if ( v12 )
      return 0;
    v11 = CURLE_WRITE_ERROR;
  }
  else
  {
    v10 = Curl_rand_hex(data, randsuffix, 9);
    v6 = 0;
    if ( v10 )
    {
      v11 = v10;
    }
    else
    {
      v14 = curl_maprintf("%s.%s.tmp", filename, (const char *)randsuffix);
      if ( v14 )
      {
        v6 = (char *)v14;
        v15 = open64(v14, 193, 384);
        v11 = CURLE_WRITE_ERROR;
        if ( v15 != -1 )
        {
          v16 = v15;
          if ( fstat64(v15, v18) == -1 || v18[6] != v21 || v18[7] != v22 || fchmod(v16, v9) != -1 )
          {
            v17 = fdopen(v16, "w");
            *fh = v17;
            if ( v17 )
            {
              v11 = CURLE_OK;
              goto LABEL_9;
            }
          }
          close(v16);
          unlink(v6);
        }
      }
      else
      {
        v11 = CURLE_OUT_OF_MEMORY;
        v6 = 0;
      }
    }
  }
  ((void (__fastcall *)(char *))*Curl_cfree)(v6);
  v6 = 0;
LABEL_9:
  *tempname = v6;
  return v11;
}
