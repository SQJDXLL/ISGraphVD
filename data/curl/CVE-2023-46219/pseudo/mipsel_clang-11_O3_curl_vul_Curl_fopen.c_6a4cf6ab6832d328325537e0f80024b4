int __fastcall Curl_fopen(Curl_easy *data, const char *filename, FILE **fh, char **tempname)
{
  __mode_t v8; // $s5
  int v9; // $v0
  char *v10; // $s3
  int v11; // $s4
  FILE *v12; // $v0
  int v14; // $v0
  int v15; // $v0
  int v16; // $s6
  FILE *v17; // $v0
  char v18[32]; // [sp+10h] [-14Ch] BYREF
  int v19; // [sp+30h] [-12Ch]
  int v20; // [sp+34h] [-128h]
  char v21[24]; // [sp+B0h] [-ACh] BYREF
  __mode_t v22; // [sp+C8h] [-94h]
  int v23; // [sp+D0h] [-8Ch]
  int v24; // [sp+D4h] [-88h]
  char v25[12]; // [sp+150h] [-Ch] BYREF

  *tempname = 0;
  if ( stat64(filename, v21) != -1 )
  {
    v8 = v22;
    if ( (v22 & 0xF000) == 0x8000 )
    {
      v9 = Curl_rand_hex(data, v25, 9);
      v10 = 0;
      if ( v9 )
      {
        v11 = v9;
      }
      else
      {
        v14 = curl_maprintf("%s.%s.tmp", filename, v25);
        if ( v14 )
        {
          v10 = (char *)v14;
          v15 = open64(v14, 1281, 384);
          v11 = 23;
          if ( v15 != -1 )
          {
            v16 = v15;
            if ( fstat64(v15, v18) == -1 || v19 != v23 || v20 != v24 || fchmod(v16, v8) != -1 )
            {
              v17 = fdopen(v16, "w");
              *fh = v17;
              if ( v17 )
              {
                v11 = 0;
                goto LABEL_9;
              }
            }
            close(v16);
            unlink(v10);
          }
        }
        else
        {
          v11 = 27;
          v10 = 0;
        }
      }
LABEL_8:
      Curl_cfree(v10);
      v10 = 0;
LABEL_9:
      *tempname = v10;
      return v11;
    }
  }
  v12 = (FILE *)fopen64(filename, "w");
  v10 = 0;
  *fh = v12;
  if ( !v12 )
  {
    v11 = 23;
    goto LABEL_8;
  }
  return 0;
}
