Cookie *__fastcall Curl_cookie_add(
        Curl_easy *data,
        CookieInfo *c,
        int httpheader,
        int noexpire,
        int a5,
        int a6,
        int httpheaderb,
        int noexpireb,
        const char *lineptr,
        const char *domain,
        const char *path,
        bool secure)
{
  char *v13; // $s3
  Cookie *v14; // $s5
  Cookie *v15; // $s2
  unsigned int v16; // $a0
  unsigned int v17; // $s0
  int v18; // $v0
  const char *v19; // $s4
  size_t v20; // $s2
  char *v21; // $s1
  _BOOL4 v22; // $v0
  int v23; // $v0
  size_t v24; // $s2
  int v25; // $v0
  Cookie *v26; // $a0
  int v27; // $s6
  size_t v28; // $a2
  _BYTE *v29; // $v0
  bool v30; // dc
  int v31; // $v0
  const char *v32; // $v0
  int is_ipnum; // $s0
  const char *v34; // $s3
  size_t v35; // $v0
  size_t v36; // $a2
  Curl_easy *v37; // $v0
  const char *name; // $s2
  Cookie *v39; // $a0
  char *value; // $s0
  int v41; // $v0
  char *v42; // $v0
  int v43; // $v0
  int v44; // $v0
  curl_off_t expires; // $v0
  time_t v46; // $a2
  int v47; // $a0
  time_t v48; // $a0
  unsigned int v49; // $a0
  int v50; // $v0
  int v51; // $v0
  const char *v52; // $s0
  char *v53; // $a2
  char *v54; // $v0
  const char *v55; // $s1
  int v56; // $v0
  size_t v57; // $s0
  char *v58; // $a0
  char *v59; // $v0
  char *v60; // $v0
  char *v61; // $v0
  CookieInfo *v62; // $v1
  const char *v63; // $a0
  int v64; // $v0
  Cookie *v65; // $a0
  void (*v66)(Cookie *); // $t9
  CookieInfo *v67; // $v1
  int v68; // $v0
  size_t v69; // $v0
  Cookie **v70; // $s7
  Cookie *v71; // $s0
  int livecookie; // $s6
  Cookie *v73; // $s1
  char *v74; // $a0
  char *v75; // $a1
  const char *spath; // $s3
  char *v77; // $s4
  char *v78; // $v0
  size_t v79; // $a2
  char *v80; // $a0
  char *v81; // $a1
  char *v82; // $a0
  char *v83; // $a1
  Cookie *v84; // $v0
  Cookie *v85; // $v1
  char *v86; // $a2
  char *v87; // $a1
  char *v88; // $a0
  Curl_easy *v89; // $v0
  __int64 v90; // $v0
  CookieInfo *v91; // $a0
  const char *v92; // $a2
  int v94; // $s7
  size_t v95; // $v0
  char *v96; // $s6
  char v97[4]; // [sp+30h] [-B8h] BYREF
  CookieInfo *ca; // [sp+34h] [-B4h]
  void (*v99)(Cookie *); // [sp+38h] [-B0h]
  Curl_easy *dataa; // [sp+3Ch] [-ACh]
  const char *domain_0; // [sp+40h] [-A8h]
  _BOOL4 v102; // [sp+44h] [-A4h]
  const char *v103; // [sp+48h] [-A0h]
  time_t now; // [sp+4Ch] [-9Ch]
  void (*v105)(Cookie *); // [sp+50h] [-98h]
  void (*v106)(char **, const char *, size_t); // [sp+54h] [-94h]
  const char *v107; // [sp+58h] [-90h]
  int badcookie; // [sp+5Ch] [-8Ch]
  char *tok_buf; // [sp+60h] [-88h] BYREF
  char date[128]; // [sp+64h] [-84h] BYREF

  dataa = data;
  ca = c;
  v13 = (char *)lineptr;
  domain_0 = domain;
  v103 = path;
  v102 = secure;
  now = time(0u);
  if ( data->req.setcookies >= 0x32u )
    return 0;
  v14 = (Cookie *)Curl_ccalloc(1, 48);
  if ( !v14 )
    return 0;
  if ( !httpheader )
  {
    tok_buf = 0;
    if ( !strncmp(lineptr, "#HttpOnly_", 0xAu) )
    {
      v13 = (char *)(lineptr + 10);
      v14->httponly = 1;
    }
    if ( *v13 != 35 )
    {
      v60 = strchr(v13, 13);
      if ( v60 )
        *v60 = 0;
      v61 = strchr(v13, 10);
      if ( v61 )
        *v61 = 0;
      if ( strtok_r(v13, "\t", &tok_buf) )
        __asm { jr      $v0 }
      freecookie(v14);
      return 0;
    }
LABEL_6:
    Curl_cfree(v14);
    return 0;
  }
  if ( strlen(lineptr) >= 0x1389 )
    goto LABEL_6;
  badcookie = 0;
  v105 = freecookie;
  v107 = "path";
  v106 = strstore;
  v99 = freecookie;
  while ( 1 )
  {
    while ( 1 )
    {
      v94 = *v13;
      if ( !*v13 || v94 != 32 && v94 != 9 )
        break;
      ++v13;
    }
    v95 = strcspn(v13, ";\t\r\n=");
    v17 = v95;
    if ( v95 )
      break;
    v41 = *v13;
    if ( !*v13 )
      goto LABEL_125;
LABEL_247:
    ++v13;
    if ( v41 != 59 )
      goto LABEL_125;
  }
  v96 = &v13[v95];
  while ( 1 )
  {
    v16 = v17--;
    v18 = v13[v17];
    if ( v18 != 32 && v18 != 9 )
      break;
    if ( !v17 )
      goto LABEL_12;
  }
  v17 = v16;
LABEL_12:
  v19 = v96 + 1;
  if ( *v96 != 61 )
  {
    v21 = v96;
    if ( v17 >= 0xFFF )
    {
      v24 = 0;
      goto LABEL_57;
    }
    v19 = 0;
    v27 = 0;
    v24 = 0;
LABEL_28:
    if ( v17 >= 7 && v94 == 95 && v13[1] == 95 )
    {
      if ( curl_strnequal("__Secure-", v13, 9) )
      {
        v14->prefix |= 1u;
      }
      else if ( curl_strnequal("__Host-", v13, 7) )
      {
        v14->prefix |= 2u;
      }
    }
    if ( !v14->name )
    {
      if ( !v27 )
        goto LABEL_73;
      v106(&v14->name, v13, v17);
      v106(&v14->value, v19, v24);
      name = v14->name;
      v39 = v14;
      if ( !name )
        goto LABEL_74;
      value = v14->value;
      if ( !value )
        goto LABEL_74;
      if ( value[strcspn(v14->value, badoctets_0)] || name[strcspn(name, badoctets_0)] )
      {
        if ( (*(_DWORD *)(&dataa->set.connect_only + 2) & 0x100000) != 0 )
        {
          Curl_infof(dataa, "invalid octets in name/value, cookie dropped");
          v39 = v14;
          goto LABEL_74;
        }
        goto LABEL_73;
      }
      goto LABEL_83;
    }
    if ( !v24 )
    {
      if ( v17 == 6 )
      {
        if ( curl_strnequal("secure", v13, 6) )
        {
          if ( !v102 && ca->running )
            goto LABEL_73;
          v14->secure = 1;
          goto LABEL_83;
        }
        if ( !v27 )
        {
          v41 = *v21;
LABEL_84:
          if ( v41 )
          {
            do
            {
              if ( v41 == 32 )
              {
                ++v21;
              }
              else
              {
                v13 = v21;
                if ( v41 != 9 )
                  goto LABEL_247;
                ++v21;
              }
              v41 = *v21;
            }
            while ( *v21 );
          }
LABEL_125:
          if ( !badcookie )
          {
            if ( !v14->domain )
            {
              if ( domain_0 )
              {
                v51 = Curl_cstrdup(domain_0);
                v14->domain = (char *)v51;
                if ( !v51 )
                {
                  v39 = v14;
                  goto LABEL_74;
                }
              }
            }
            if ( v14->path
              || (v52 = v103) == 0
              || ((v53 = strchr(v103, 63)) == 0 ? (v54 = strrchr(v52, 47)) : (v54 = (char *)Curl_memrchr(
                                                                                              v103,
                                                                                              47,
                                                                                              v53 - v103)),
                  !v54) )
            {
LABEL_128:
              if ( v14->name )
              {
                ++dataa->req.setcookies;
                if ( (v14->prefix & 1) != 0 )
                {
                  if ( !v14->secure )
                  {
LABEL_190:
                    freecookie(v14);
                    return 0;
                  }
                  v62 = ca;
                  if ( (v14->prefix & 2) == 0 )
                  {
LABEL_158:
                    if ( !v62->running && v62->newsession )
                    {
                      v39 = v14;
                      if ( !v14->expires )
                        goto LABEL_74;
                    }
                    v14->livecookie = v62->running;
                    v67 = ca;
                    v68 = ca->lastct + 1;
                    ca->lastct = v68;
                    v14->creationtime = v68;
                    if ( !noexpire )
                      remove_expired(v67);
                    v69 = cookiehash(v14->domain);
                    v70 = &ca->cookies[v69];
                    v71 = *v70;
                    livecookie = 0;
                    if ( *v70 )
                    {
                      v15 = 0;
                      v73 = 0;
                      while ( 1 )
                      {
                        if ( !curl_strequal(v71->name, v14->name) )
                          goto LABEL_173;
                        v74 = v71->domain;
                        if ( v74 )
                        {
                          v75 = v14->domain;
                          if ( !v75 || !curl_strequal(v74, v75) )
                            goto LABEL_173;
                        }
                        else if ( v14->domain )
                        {
                          goto LABEL_173;
                        }
                        spath = v71->spath;
                        if ( spath )
                        {
                          v77 = v14->spath;
                          if ( v77 )
                          {
                            if ( v71->secure && !v14->secure && !v102 )
                            {
                              v78 = strchr(spath + 1, 47);
                              v79 = v78 ? v78 - spath : strlen(spath);
                              if ( curl_strnequal(spath, v77, v79) )
                              {
                                if ( (*(_DWORD *)(&dataa->set.connect_only + 2) & 0x100000) != 0 )
                                  Curl_infof(
                                    dataa,
                                    "cookie '%s' for domain '%s' dropped, would overlay an existing cookie",
                                    v14->name,
                                    v14->domain);
                                goto LABEL_190;
                              }
                            }
                          }
                        }
LABEL_173:
                        if ( v73 || !curl_strequal(v71->name, v14->name) )
                          goto LABEL_174;
                        v80 = v71->domain;
                        if ( !v80 )
                        {
                          if ( v14->domain )
                          {
LABEL_199:
                            if ( !livecookie )
                              goto LABEL_174;
                          }
                          v82 = v71->spath;
                          goto LABEL_201;
                        }
                        v81 = v14->domain;
                        if ( !v81 || !curl_strequal(v80, v81) || v71->tailmatch != v14->tailmatch )
                          goto LABEL_199;
                        v82 = v71->spath;
LABEL_201:
                        if ( v82 )
                        {
                          v83 = v14->spath;
                          if ( !v83 )
                          {
                            v73 = 0;
                            livecookie = 0;
                            goto LABEL_174;
                          }
                          livecookie = 0;
                          if ( !curl_strequal(v82, v83) )
                            goto LABEL_174;
                        }
                        livecookie = 0;
                        if ( (v71->spath == 0) == (v14->spath == 0) )
                        {
                          livecookie = v14->livecookie;
                          if ( v14->livecookie )
                          {
                            v15 = v71;
                            v73 = v14;
                          }
                          else
                          {
                            livecookie = 1;
                            if ( v71->livecookie )
                              goto LABEL_190;
                            v15 = v71;
                            v73 = v14;
                          }
                        }
LABEL_174:
                        if ( !v71->next )
                        {
                          if ( v73 )
                          {
                            v73->next = v15->next;
                            v73->creationtime = v15->creationtime;
                            Curl_cfree(v15->name);
                            Curl_cfree(v15->value);
                            Curl_cfree(v15->domain);
                            Curl_cfree(v15->path);
                            Curl_cfree(v15->spath);
                            v84 = v73;
                            v85 = v15;
                            do
                            {
                              v86 = v84->name;
                              v87 = v84->value;
                              v88 = v84->path;
                              v85->next = v84->next;
                              v85->name = v86;
                              v85->value = v87;
                              v85->path = v88;
                              v84 = (Cookie *)((char *)v84 + 16);
                              v85 = (Cookie *)((char *)v85 + 16);
                            }
                            while ( v84 != &v73[1] );
                            Curl_cfree(v73);
                          }
                          else
                          {
                            v15 = v14;
                          }
                          v89 = dataa;
                          if ( !ca->running )
                            goto LABEL_216;
                          goto LABEL_227;
                        }
                        v71 = v71->next;
                      }
                    }
                    v89 = dataa;
                    if ( ca->running )
                    {
                      v15 = v14;
LABEL_227:
                      if ( (*(_DWORD *)(&v89->set.connect_only + 2) & 0x100000) != 0 )
                      {
                        if ( livecookie )
                          v92 = "Replaced";
                        else
                          v92 = "Added";
                        Curl_infof(
                          dataa,
                          "%s cookie %s=\"%s\" for domain %s, path %s, expire %lld",
                          v92,
                          v15->name,
                          v15->value,
                          v15->domain,
                          v15->path,
                          v15->expires);
                      }
LABEL_216:
                      if ( livecookie )
                        goto LABEL_220;
                      if ( v71 )
                      {
                        v71->next = v15;
LABEL_219:
                        ++ca->numcookies;
LABEL_220:
                        HIDWORD(v90) = v15->expires;
                        LODWORD(v90) = HIDWORD(v15->expires);
                        if ( v90 )
                        {
                          v91 = ca;
                          if ( (int)v90 < SHIDWORD(ca->next_expiration)
                            || HIDWORD(ca->next_expiration) == (_DWORD)v90
                            && (v91 = ca, HIDWORD(v90) < LODWORD(ca->next_expiration)) )
                          {
                            LODWORD(v91->next_expiration) = HIDWORD(v90);
                            HIDWORD(v91->next_expiration) = v90;
                          }
                        }
                        return v15;
                      }
                    }
                    else
                    {
                      v15 = v14;
                    }
                    *v70 = v15;
                    goto LABEL_219;
                  }
                }
                else
                {
                  v62 = ca;
                  if ( (v14->prefix & 2) == 0 )
                    goto LABEL_158;
                  if ( !v14->secure )
                    goto LABEL_168;
                }
                v63 = v14->path;
                if ( v63 )
                {
                  v64 = strcmp(v63, "/");
                  v65 = v14;
                  if ( !v64 )
                  {
                    v66 = (void (*)(Cookie *))MEMORY[0xB750];
                    if ( !v14->tailmatch )
                    {
                      v62 = ca;
                      goto LABEL_158;
                    }
LABEL_170:
                    ((void (*)(Cookie *))((char *)v66 + (__int16)freecookie))(v65);
                    return 0;
                  }
LABEL_169:
                  v66 = freecookie;
                  goto LABEL_170;
                }
LABEL_168:
                v65 = v14;
                goto LABEL_169;
              }
              goto LABEL_73;
            }
            v55 = v103;
            v56 = v54 - v103;
            v57 = v56 + 1;
            v58 = (char *)Curl_cmalloc(v56 + 2);
            v14->path = v58;
            if ( v58 )
            {
              memcpy(v58, v55, v57);
              v14->path[v57] = 0;
              v59 = sanitize_cookie_path(v14->path);
              v14->spath = v59;
              if ( !v59 )
              {
                v39 = v14;
                goto LABEL_74;
              }
              goto LABEL_128;
            }
          }
LABEL_73:
          v39 = v14;
LABEL_74:
          freecookie(v39);
          return 0;
        }
LABEL_36:
        if ( v17 == 6 )
        {
          if ( curl_strnequal((char *)v105 + 0x3444, v13, 6) && v24 )
          {
            if ( *v19 == 46 )
            {
              ++v19;
              --v24;
            }
            if ( v24 == 9 )
            {
              v43 = curl_strnequal(v19, "localhost", 9);
              v28 = 9;
              if ( v43 )
              {
                v32 = domain_0;
                goto LABEL_45;
              }
            }
            else
            {
              v28 = v24;
            }
            v29 = memchr(v19, 46, v28);
            v30 = v29 == 0;
            v31 = v29 - v19;
            if ( v30 )
            {
              domain_0 = ":";
              goto LABEL_46;
            }
            v30 = v24 - v31 < 2;
            v32 = domain_0;
            if ( v30 )
            {
              domain_0 = ":";
              goto LABEL_46;
            }
LABEL_45:
            if ( !v32 )
            {
              is_ipnum = Curl_host_is_ipnum(v19);
              v36 = v24;
              goto LABEL_238;
            }
LABEL_46:
            is_ipnum = Curl_host_is_ipnum(domain_0);
            if ( !is_ipnum )
            {
              v30 = !cookie_tailmatch(v19, v24, domain_0);
              v37 = dataa;
              if ( !v30 )
              {
                strstore(&v14->domain, v19, v24);
                if ( !v14->domain )
                  goto LABEL_73;
                v14->tailmatch = 1;
                goto LABEL_83;
              }
              goto LABEL_50;
            }
            v34 = domain_0;
            if ( strncmp(v19, domain_0, v24) || (v35 = strlen(v34), v36 = v24, v35 != v24) )
            {
              v37 = dataa;
LABEL_50:
              if ( (*(_DWORD *)(&v37->set.connect_only + 2) & 0x100000) != 0 )
                Curl_infof(dataa, "skipped cookie with bad tailmatch domain: %s", v19);
              badcookie = httpheader;
              goto LABEL_83;
            }
LABEL_238:
            strstore(&v14->domain, v19, v36);
            v39 = v14;
            if ( !v14->domain )
              goto LABEL_74;
            if ( !is_ipnum )
              v14->tailmatch = 1;
            goto LABEL_83;
          }
          goto LABEL_83;
        }
        goto LABEL_82;
      }
      if ( v17 == 8 )
      {
        if ( curl_strnequal("httponly", v13, 8) )
        {
          v14->httponly = 1;
          goto LABEL_83;
        }
        if ( !v27 )
        {
LABEL_83:
          v41 = *v21;
          goto LABEL_84;
        }
LABEL_82:
        if ( v17 == 7 && !curl_strnequal("version", v13, 7) )
        {
          if ( curl_strnequal("max-age", v13, 7) )
          {
            if ( *v19 == 34 )
              ++v19;
            v44 = curlx_strtoofft(v19, 0, 10, &v14->expires);
            switch ( v44 )
            {
              case 1:
                LODWORD(v14->expires) = -1;
                HIDWORD(v14->expires) = 0x7FFFFFFF;
                break;
              case 2:
                LODWORD(v14->expires) = 1;
                HIDWORD(v14->expires) = 0;
                break;
              case 0:
                expires = v14->expires;
                if ( expires )
                {
                  v46 = now >> 0x1F;
                  v47 = 0x7FFFFFFF - (now >> 0x1F);
                  if ( v47 >= SHIDWORD(expires)
                    && ((v30 = HIDWORD(expires) != v47, v48 = now, v30) || (v48 = now, ~now >= (unsigned int)expires)) )
                  {
                    v49 = expires + v48;
                    LODWORD(v14->expires) = v49;
                    HIDWORD(v14->expires) = (v49 < (unsigned int)expires) + HIDWORD(expires) + v46;
                  }
                  else
                  {
                    LODWORD(v14->expires) = -1;
                    HIDWORD(v14->expires) = 0x7FFFFFFF;
                  }
                }
                else
                {
                  LODWORD(v14->expires) = 1;
                  HIDWORD(v14->expires) = 0;
                }
                break;
            }
          }
          else if ( curl_strnequal("expires", v13, 7) && !v14->expires && v24 < 0x80 )
          {
            memcpy(date, v19, v24);
            v97[v24 + 0x34] = 0;
            v50 = Curl_getdate_capped(date);
            if ( v50 )
            {
              if ( v50 >> 0x1F == -1 )
              {
                LODWORD(v14->expires) = 0;
                HIDWORD(v14->expires) = 0;
              }
              else
              {
                v14->expires = v50;
              }
            }
            else
            {
              LODWORD(v14->expires) = 1;
              HIDWORD(v14->expires) = 0;
            }
          }
        }
        goto LABEL_83;
      }
      if ( !v27 )
        goto LABEL_83;
    }
    if ( v17 == 4 )
    {
      if ( curl_strnequal(v107, v13, 4) )
      {
        strstore(&v14->path, v19, v24);
        if ( !v14->path )
          goto LABEL_73;
        Curl_cfree(v14->spath);
        v42 = sanitize_cookie_path(v14->path);
        v14->spath = v42;
        if ( !v42 )
        {
          v39 = v14;
          goto LABEL_74;
        }
      }
      goto LABEL_83;
    }
    goto LABEL_36;
  }
  v20 = strcspn(v96 + 1, (const char *)v99 + 0x338C);
  v21 = (char *)&v19[v20];
  if ( !v20 )
  {
    v22 = v17 < 0xFFF;
LABEL_256:
    if ( !v22 )
    {
      v24 = 0;
      goto LABEL_57;
    }
    v24 = 0;
LABEL_27:
    v27 = httpheader;
    if ( v17 + v24 >= 0x1001 )
      goto LABEL_57;
    goto LABEL_28;
  }
  while ( 1 )
  {
    v23 = v96[v20];
    if ( v23 != 32 )
      break;
    --v20;
LABEL_16:
    v22 = v17 < 0xFFF;
    if ( !v20 )
      goto LABEL_256;
  }
  --v20;
  if ( v23 == 9 )
    goto LABEL_16;
  v24 = v20 + 1;
  while ( 1 )
  {
    v25 = *v19;
    if ( v25 != 32 )
      break;
    --v24;
LABEL_21:
    ++v19;
    if ( !v24 )
      goto LABEL_25;
  }
  --v24;
  if ( v25 == 9 )
    goto LABEL_21;
  if ( memchr(v19, 9, ++v24) )
  {
    freecookie(v14);
    if ( (*(_DWORD *)(&dataa->set.connect_only + 2) & 0x100000) != 0 )
      Curl_infof(dataa, "cookie contains TAB, dropping");
    return 0;
  }
LABEL_25:
  if ( v17 >= 0xFFF )
  {
LABEL_57:
    v26 = v14;
    goto LABEL_58;
  }
  v26 = v14;
  if ( v24 < 0xFFF )
    goto LABEL_27;
LABEL_58:
  freecookie(v26);
  if ( (*(_DWORD *)(&dataa->set.connect_only + 2) & 0x100000) != 0 )
    Curl_infof(dataa, "oversized cookie dropped, name/val %zu + %zu bytes", v17, v24);
  return 0;
}
