int __fastcall cache_insert(const char *a1, const void *a2, int a3, int a4, unsigned __int16 a5)
{
  int result; // $v0
  __int16 v10; // $s4
  int v11; // $s5
  int v12; // $s7
  int v13; // $s0
  int v14; // $a3
  int v15; // $a0
  int v16; // $v0
  bool v17; // dc
  _DWORD *v18; // $a0
  __int16 v19; // $v0
  int v20; // $v1
  int v21; // $v0
  char *v22; // $a0
  int v23; // $v0
  _BYTE *v24; // $v1

  log_query(a5 | 0x400, a1, a2, 0);
  result = 0;
  if ( !dword_4346E8 )
  {
    v10 = a5 & 0xFFFD;
    v11 = a5 & 4;
    if ( sub_4037AC(a1, a2, a3, a5 & 0xFFFD) )
    {
      v12 = 0;
      while ( 1 )
      {
        v13 = dword_4346D8;
        if ( !dword_4346D8 )
        {
          dword_4346E8 = 1;
          goto LABEL_44;
        }
        v14 = *(unsigned __int16 *)(dword_4346D8 + 36);
        if ( (v14 & 0xC) == 0 )
          break;
        if ( v12 )
          goto LABEL_21;
        if ( v11 )
        {
          if ( (v14 & 0x200) != 0 || (v15 = dword_4346D8 + 40, (v14 & 0x10) != 0) )
            v15 = *(_DWORD *)(dword_4346D8 + 40);
          v12 = 1;
          sub_4037AC(v15, dword_4346D8 + 20, a3, v14);
          ++dword_4346C4;
        }
        else
        {
          v11 = 1;
          sub_4037AC(0, 0, a3, 0);
        }
      }
      v16 = 0;
      if ( a1 )
      {
        v17 = strlen(a1) < 0x28;
        v16 = 0;
        if ( !v17 )
        {
          v16 = dword_4346E0;
          if ( dword_4346E0 )
          {
            dword_4346E0 = *(_DWORD *)dword_4346E0;
          }
          else
          {
            if ( !dword_4346EC || (v16 = whine_malloc(1028)) == 0 )
            {
LABEL_21:
              dword_4346E8 = 1;
              v13 = 0;
              goto LABEL_44;
            }
            --dword_4346EC;
          }
        }
      }
      v18 = *(_DWORD **)(v13 + 4);
      if ( v18 )
        *v18 = *(_DWORD *)v13;
      else
        dword_4346D4 = *(_DWORD *)v13;
      if ( *(_DWORD *)v13 )
        *(_DWORD *)(*(_DWORD *)v13 + 4) = *(_DWORD *)(v13 + 4);
      else
        dword_4346D8 = *(_DWORD *)(v13 + 4);
      *(_WORD *)(v13 + 36) = v10;
      if ( v16 )
      {
        *(_DWORD *)(v13 + 40) = v16;
        *(_WORD *)(v13 + 36) = v10 | 0x200;
      }
      v19 = *(_WORD *)(v13 + 36);
      v20 = v19 & 0x200;
      if ( a1 )
      {
        v21 = v19 & 0x10;
        if ( v20 || (v22 = (char *)(v13 + 40), v21) )
          v22 = *(char **)(v13 + 40);
        strcpy(v22, a1);
      }
      else
      {
        v23 = v19 & 0x10;
        if ( v20 || (v24 = (_BYTE *)(v13 + 40), v23) )
          v24 = *(_BYTE **)(v13 + 40);
        *v24 = 0;
      }
      if ( a2 )
        memcpy((void *)(v13 + 20), a2, 0x10u);
      else
        *(_DWORD *)(v13 + 20) = 0;
      *(_DWORD *)(v13 + 12) = a4 + a3;
      *(_DWORD *)v13 = dword_4346E4;
      dword_4346E4 = v13;
    }
    else
    {
      v13 = 0;
      dword_4346E8 = 1;
    }
LABEL_44:
    result = v13;
  }
  return result;
}
