int __fastcall cache_insert(int a1, int a2, int a3, int a4, unsigned __int16 a5)
{
  __int16 v8; // $s5
  int v9; // $s1
  int v10; // $v1
  int v11; // $v0
  int v12; // $s0
  int v13; // $s1
  int v14; // $v0
  int v15; // $v1
  int v17; // [sp+18h] [-8h]

  log_query(a5 | 0x400, a1, a2, 0);
  v8 = a5 & 0xFFFD;
  if ( dword_4367B4 )
    return 0;
  if ( !sub_406BA4(a1, a2, a3, a5 & 0xFFFD) )
  {
    dword_4367B4 = 1;
    return 0;
  }
  v9 = a5 & 4;
  v10 = 0;
  while ( 1 )
  {
    v12 = dword_4367CC;
    if ( !dword_4367CC )
      goto LABEL_17;
    if ( (*(_WORD *)(dword_4367CC + 36) & 0xC) == 0 )
      break;
    if ( v10 )
      goto LABEL_17;
    if ( v9 )
    {
      v17 = *(unsigned __int16 *)(dword_4367CC + 36);
      v11 = cache_get_name(dword_4367CC);
      sub_406BA4(v11, v12 + 20, a3, v17);
      v10 = 1;
      ++dword_4367B8;
    }
    else
    {
      v9 = 1;
      sub_406BA4(0, 0, a3, 0);
      v10 = 0;
    }
  }
  if ( a1 && (unsigned int)strlen(a1) >= 0x28 )
  {
    v13 = dword_4367B0;
    if ( dword_4367B0 )
    {
      dword_4367B0 = *(_DWORD *)dword_4367B0;
    }
    else
    {
      if ( !dword_4367AC || (v13 = whine_malloc(1028)) == 0 )
      {
LABEL_17:
        dword_4367B4 = 1;
        return 0;
      }
      --dword_4367AC;
    }
  }
  else
  {
    v13 = 0;
  }
  sub_4064A8(v12);
  *(_WORD *)(v12 + 36) = v8;
  if ( v13 )
  {
    *(_DWORD *)(v12 + 40) = v13;
    *(_WORD *)(v12 + 36) = v8 | 0x200;
  }
  if ( a1 )
  {
    v14 = cache_get_name(v12);
    strcpy(v14, a1);
  }
  else
  {
    *(_BYTE *)cache_get_name(v12) = 0;
  }
  if ( a2 )
    memcpy(v12 + 20, a2, 16);
  else
    *(_DWORD *)(v12 + 20) = 0;
  v15 = dword_4367C0;
  *(_DWORD *)(v12 + 12) = a3 + a4;
  dword_4367C0 = v12;
  *(_DWORD *)v12 = v15;
  return v12;
}
