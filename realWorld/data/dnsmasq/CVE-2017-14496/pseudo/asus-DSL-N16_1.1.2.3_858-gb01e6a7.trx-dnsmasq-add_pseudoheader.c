unsigned int __fastcall add_pseudoheader(int a1, int a2, int a3, int a4, int a5, void *src, size_t n, int a8, int a9)
{
  unsigned __int16 v9; // $fp
  __int16 v10; // $s4
  unsigned int v11; // $s5
  int v12; // $v1
  _BYTE *v13; // $t0
  __int16 v14; // $a3
  __int16 v15; // $a0
  _WORD *v16; // $s3
  int v17; // $s2
  unsigned __int8 *v18; // $s0
  int v19; // $s1
  int v20; // $a2
  unsigned __int8 *v21; // $a3
  int v22; // $a1
  void *v23; // $s1
  int v24; // $a0
  unsigned __int8 *v26; // $a1
  char *v27; // $a3
  __int16 v28; // $s2
  _WORD *v29; // $s1
  unsigned __int8 *v30; // $a2
  unsigned __int8 *v31; // $s3
  int v32; // $v0
  char *v33; // $s3
  char v34; // $a2^1
  _WORD *v35; // $s6
  void *v36; // $v0
  int v37; // [sp+20h] [-18h] BYREF
  int v38; // [sp+24h] [-14h] BYREF
  int v39; // [sp+28h] [-10h] BYREF
  int v40; // [sp+30h] [-8h]

  v9 = a4;
  v10 = 0;
  if ( a8 )
    v10 = 0x8000;
  v11 = a2;
  v12 = find_pseudoheader(a1, a2, 0, &v37, &v38, &v39);
  if ( v38 )
    return v11;
  v13 = (_BYTE *)v37;
  if ( !v12 )
  {
    v23 = 0;
    v17 = 0;
    v40 = 0;
LABEL_15:
    v24 = skip_questions(a1, v11);
    if ( v24 )
    {
      v32 = skip_section(
              v24,
              *(unsigned __int16 *)(a1 + 8) + *(unsigned __int16 *)(a1 + 6) + *(unsigned __int16 *)(a1 + 10),
              a1,
              v11);
      if ( v32 )
      {
        v33 = (char *)(v32 + 11);
        v34 = BYTE2(v40);
        if ( a3 >= (unsigned int)(v32 + 11) )
        {
          *(_BYTE *)(v32 + 9) = BYTE2(v17);
          *(_BYTE *)(v32 + 2) = 41;
          *(_WORD *)(v32 + 3) = v9;
          *(_BYTE *)(v32 + 5) = v34;
          v35 = (_WORD *)(v32 + 9);
          *(_BYTE *)(v32 + 6) = v40;
          *(_WORD *)(v32 + 7) = v10;
          *(_BYTE *)v32 = 0;
          *(_BYTE *)(v32 + 1) = 0;
          v18 = (unsigned __int8 *)(v32 + 11);
          *(_BYTE *)(v32 + 10) = v17;
          if ( !v23 )
          {
LABEL_36:
            v27 = (char *)(v18 + 4);
            if ( a3 - (int)(v18 + 4) < (int)n )
              return v11;
            v30 = v18;
            ++*(_WORD *)(a1 + 10);
            if ( !a5 )
              return (unsigned int)&v30[-a1];
            v28 = (__int16)v33;
            v29 = v35;
            goto LABEL_24;
          }
          v18 = (unsigned __int8 *)&v33[v17];
          if ( a3 >= (unsigned int)&v33[v17] )
          {
            memcpy(v33, v23, v17);
            free(v23);
            goto LABEL_36;
          }
        }
      }
    }
    free(v23);
    return v11;
  }
  v14 = *(unsigned __int8 *)(v37 + 5);
  v15 = *(unsigned __int8 *)(v37 + 4) << 8;
  v9 = _byteswap_ushort(*(_WORD *)v37);
  v40 = (*(unsigned __int8 *)(v37 + 2) << 8) | *(unsigned __int8 *)(v37 + 3);
  v10 = v15 | v14;
  v16 = (_WORD *)(v37 + 6);
  if ( a8 )
  {
    v10 |= 0x8000u;
    *(_BYTE *)(v37 + 4) = HIBYTE(v10);
    v13[5] = v10;
  }
  v17 = (unsigned __int8)v13[7] | ((unsigned __int8)v13[6] << 8);
  if ( v11 < (unsigned int)&v13[v17 + 8 - a1] )
    return v11;
  v18 = (unsigned __int8 *)(v16 + 1);
  if ( !a5 )
    return v11;
  v19 = 0;
  while ( 1 )
  {
    v20 = v19 + 4;
    v21 = v18 + 4;
    if ( v19 + 4 >= v17 )
      break;
    v22 = (v18[2] << 8) | v18[3];
    if ( v17 < v22 + v20 )
    {
      v39 = 0;
      v23 = 0;
      v17 = 0;
LABEL_30:
      v11 = rrfilter(a1, v11, 0, v21);
      goto LABEL_15;
    }
    if ( ((*v18 << 8) | v18[1]) == a5 )
    {
      v17 = v17 - 4 - v22;
      v26 = &v18[v22 + 4];
      if ( !a9 )
        return v11;
      memmove(v18, v26, v17 - v19);
      *v16 = v17;
    }
    else
    {
      v18 = &v21[v22];
      v19 = v22 + v20;
    }
  }
  if ( !v39 )
  {
    v23 = 0;
    if ( v17 )
    {
      v36 = (void *)whine_malloc(v17);
      v23 = v36;
      if ( v36 )
        memcpy(v36, v16 + 1, v17);
    }
    goto LABEL_30;
  }
  if ( !v18 )
  {
    v23 = 0;
    goto LABEL_15;
  }
  v27 = (char *)(v18 + 4);
  v28 = (_WORD)v16 + 2;
  if ( a3 - (int)(v18 + 4) < (int)n )
    return v11;
  v29 = v16;
LABEL_24:
  v30 = v18;
  if ( a9 == 2 )
    return (unsigned int)&v30[-a1];
  if ( a3 >= (unsigned int)v27 )
  {
    v31 = (unsigned __int8 *)&v27[n];
    v18[3] = n;
    *(_WORD *)v18 = a5;
    v18[2] = BYTE2(n);
    if ( a3 >= (unsigned int)&v27[n] )
    {
      memcpy(v27, src, n);
      v30 = v31;
      *v29 = (_WORD)v31 - v28;
      return (unsigned int)&v30[-a1];
    }
  }
  return v11;
}
