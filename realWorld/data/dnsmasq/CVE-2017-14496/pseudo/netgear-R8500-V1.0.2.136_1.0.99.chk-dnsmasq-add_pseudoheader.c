unsigned __int8 *__fastcall add_pseudoheader(int a1, int a2, int a3, int a4, int a5, void *src, size_t n, int a8, int a9)
{
  unsigned int v9; // r9
  int v10; // r11
  int v11; // r0
  _BYTE *v12; // r10
  int v13; // r4
  unsigned __int8 *v14; // r6
  int v15; // r8
  int v16; // r7
  int v17; // r0
  unsigned int v18; // r3
  __int16 v19; // r4
  bool v20; // zf
  void *v21; // r0
  size_t v22; // r7
  void *v24; // r7
  int v25; // r0
  _BYTE *v26; // r0
  _BYTE *v27; // r8
  int v28; // r2
  void *v29; // r0
  unsigned __int16 v31; // [sp+10h] [bp-48h]
  unsigned __int16 v33; // [sp+1Ch] [bp-3Ch]
  int v34; // [sp+24h] [bp-34h]
  int v35; // [sp+28h] [bp-30h]
  int v36; // [sp+2Ch] [bp-2Ch]

  v9 = a2;
  v31 = a4;
  if ( a8 )
    LOWORD(v10) = 0x8000;
  else
    LOWORD(v10) = 0;
  v11 = find_pseudoheader(a1, a2);
  if ( v35 )
    return (unsigned __int8 *)v9;
  if ( !v11 )
  {
    v13 = 0;
    v24 = 0;
    v33 = 0;
LABEL_31:
    v25 = skip_questions(a1, v9);
    if ( v25 )
    {
      v26 = (_BYTE *)skip_section(
                       v25,
                       (unsigned __int16)((*(_WORD *)(a1 + 6) << 8) | HIBYTE(*(_WORD *)(a1 + 6)))
                     + (unsigned __int16)((*(_WORD *)(a1 + 8) << 8) | HIBYTE(*(_WORD *)(a1 + 8)))
                     + (unsigned __int16)((*(_WORD *)(a1 + 10) << 8) | HIBYTE(*(_WORD *)(a1 + 10))));
      if ( v26 )
      {
        v27 = v26 + 11;
        if ( a3 >= (unsigned int)(v26 + 11) )
        {
          v12 = v26 + 9;
          *v26 = 0;
          v26[1] = 0;
          v26[2] = 41;
          v26[3] = HIBYTE(v31);
          v26[5] = HIBYTE(v33);
          v26[4] = v31;
          v26[6] = v33;
          v26[8] = v10;
          v26[7] = BYTE1(v10);
          v26[9] = BYTE1(v13);
          v26[10] = v13;
          if ( !v24 )
          {
            v14 = v26 + 11;
            goto LABEL_37;
          }
          v14 = &v27[v13];
          if ( a3 >= (unsigned int)&v27[v13] )
          {
            memcpy(v26 + 11, v24, v13);
            free(v24);
LABEL_37:
            v18 = (unsigned int)(v14 + 4);
            if ( (int)n > a3 - (int)(v14 + 4) )
              return (unsigned __int8 *)v9;
            v19 = (__int16)v27;
            v28 = ((*(unsigned __int16 *)(a1 + 10) << 8) | HIBYTE(*(unsigned __int16 *)(a1 + 10))) + 1;
            *(_WORD *)(a1 + 10) = BYTE1(v28) | (unsigned __int16)((_WORD)v28 << 8);
            goto LABEL_22;
          }
        }
      }
    }
    free(v24);
    return (unsigned __int8 *)v9;
  }
  v12 = (_BYTE *)(v36 + 6);
  v31 = _byteswap_ushort(*(_WORD *)v36);
  v33 = _byteswap_ushort(*(_WORD *)(v36 + 2));
  v10 = *(unsigned __int8 *)(v36 + 5) | (*(unsigned __int8 *)(v36 + 4) << 8);
  if ( a8 )
  {
    LOWORD(v10) = ~((unsigned int)~(v10 << 17) >> 17);
    *(_BYTE *)(v36 + 4) = BYTE1(v10);
    *(_BYTE *)(v36 + 5) = v10;
  }
  v13 = *(unsigned __int8 *)(v36 + 7) | (*(unsigned __int8 *)(v36 + 6) << 8);
  if ( v9 < v36 + 8 - a1 + v13 || !a5 )
    return (unsigned __int8 *)v9;
  v14 = (unsigned __int8 *)(v36 + 8);
  v15 = 0;
  v16 = 4;
  while ( v13 > v16 )
  {
    v17 = v14[3] | (v14[2] << 8);
    if ( v13 < v17 + v16 )
    {
      v13 = 0;
      v24 = 0;
LABEL_40:
      v9 = rrfilter(a1, v9, 0);
      goto LABEL_31;
    }
    if ( (v14[1] | (*v14 << 8)) == a5 )
    {
      v13 = v13 - 4 - v17;
      if ( !a9 )
        return (unsigned __int8 *)v9;
      memmove(v14, &v14[v17 + 4], v13 - v15);
      *v12 = BYTE1(v13);
      *(_BYTE *)(v36 + 7) = v13;
    }
    else
    {
      v15 = v17 + v16;
      v14 += v17 + 4;
      v16 += v17 + 4;
    }
  }
  if ( !v34 )
  {
    if ( v13 )
    {
      v29 = (void *)whine_malloc(v13);
      v24 = v29;
      if ( v29 )
        memcpy(v29, (const void *)(v36 + 8), v13);
    }
    else
    {
      v24 = 0;
    }
    goto LABEL_40;
  }
  if ( !v14 )
  {
    v24 = 0;
    goto LABEL_31;
  }
  v18 = (unsigned int)(v14 + 4);
  if ( (int)n > a3 - (int)(v14 + 4) )
    return (unsigned __int8 *)v9;
  v19 = v36 + 8;
LABEL_22:
  v20 = a9 == 2;
  if ( a9 != 2 )
    v20 = a5 == 0;
  if ( v20 )
    return &v14[-a1];
  if ( a3 >= v18 )
  {
    v21 = v14 + 4;
    v22 = (size_t)&v14[n + 4];
    *v14 = BYTE1(a5);
    v14[1] = a5;
    v14[2] = BYTE1(n);
    v14[3] = n;
    if ( a3 >= v22 )
    {
      v14 += n + 4;
      memcpy(v21, src, n);
      v12[1] = v22 - v19;
      *v12 = (unsigned __int16)(v22 - v19) >> 8;
      return &v14[-a1];
    }
  }
  return (unsigned __int8 *)v9;
}
