unsigned int __fastcall add_pseudoheader(int a1, int a2, int a3, int a4, int a5, void *src, size_t n, int a8, int a9)
{
  __int16 v9; // $s4
  unsigned int v11; // $s5
  int v12; // $v1
  unsigned __int16 v13; // $s6
  unsigned __int8 *v14; // $a1
  _BYTE *v15; // $s2
  const void *v16; // $s3
  int v17; // $s1
  _BYTE *v18; // $s7
  unsigned __int8 *v19; // $s0
  int v20; // $s4
  int v21; // $a1
  int v22; // $v0
  unsigned __int8 *v23; // $a1
  __int16 v24; // $s2
  void *v25; // $s0
  void *v26; // $v0
  __int16 v27; // $s1
  int v28; // $t0
  _BYTE *v29; // $v0
  _BYTE *v30; // $s3
  _BYTE *v31; // $s2
  void *v32; // $a2
  size_t v33; // $s0
  unsigned __int8 *v35; // [sp+20h] [-20h] BYREF
  int v36; // [sp+24h] [-1Ch] BYREF
  int v37; // [sp+28h] [-18h] BYREF
  int v38; // [sp+30h] [-10h]
  int v39; // [sp+34h] [-Ch]
  int v40; // [sp+38h] [-8h]
  int v41; // [sp+3Ch] [-4h]

  v9 = a4;
  v11 = a2;
  v12 = find_pseudoheader(a1, a2, 0, &v35, &v36, &v37);
  v13 = 0x8000;
  if ( !a8 )
    v13 = 0;
  if ( !v36 )
  {
    v14 = v35;
    if ( !v12 )
    {
      v25 = 0;
      v17 = 0;
      v24 = 0;
      goto LABEL_25;
    }
    v13 = _byteswap_ushort(*((_WORD *)v35 + 2));
    v15 = v35 + 6;
    v41 = *v35;
    v40 = v35[1];
    v39 = v35[2];
    v38 = v35[3];
    if ( a8 )
    {
      v13 |= 0x8000u;
      v35[4] = HIBYTE(v13);
      v14[5] = v13;
    }
    v16 = v14 + 8;
    v17 = v14[7] | (v14[6] << 8);
    if ( v11 >= (unsigned int)&v14[v17 + 8 - a1] )
    {
      v18 = v14 + 6;
      if ( a5 )
      {
        v19 = v14 + 8;
        v20 = 0;
        while ( v20 + 4 < v17 )
        {
          v21 = (v19[2] << 8) | v19[3];
          v22 = (*v19 << 8) | v19[1];
          v19 += 4;
          if ( v17 < v21 + v20 )
          {
            v17 = 0;
            v37 = 0;
            break;
          }
          if ( v22 == a5 )
          {
            v17 = v17 - 4 - v21;
            v19 -= 4;
            v23 = &v19[v21 + 4];
            if ( !a9 )
              return v11;
            memcpy(v19, v23, v17 - v20);
            *v15 = BYTE1(v17);
            v15[1] = v17;
          }
          else
          {
            v20 += 4 + v21;
            v19 += v21;
          }
        }
        v9 = ((_WORD)v41 << 8) | v40;
        v24 = ((_WORD)v39 << 8) | v38;
        if ( v37 )
        {
          if ( v19 )
          {
            v27 = (__int16)v16;
LABEL_31:
            v32 = v19 + 4;
            if ( a3 - (int)(v19 + 4) >= (int)n )
            {
              v11 = (unsigned int)&v19[-a1];
              if ( a5 )
              {
                if ( a9 != 2 )
                {
                  *v19 = BYTE1(a5);
                  v19[3] = n;
                  v19[1] = a5;
                  v19[2] = BYTE1(n);
                  v33 = (size_t)v32 + n;
                  memcpy(v32, src, n);
                  v18[1] = v33 - v27;
                  *v18 = (unsigned __int16)(v33 - v27) >> 8;
                  v11 = v33 - a1;
                }
              }
            }
            return v11;
          }
          v25 = 0;
        }
        else
        {
          v25 = 0;
          if ( v17 )
          {
            v26 = (void *)whine_malloc(v17);
            v25 = v26;
            if ( v26 )
              memcpy(v26, v16, v17);
          }
          v11 = rrfilter(a1, v11, 0);
        }
LABEL_25:
        v28 = skip_questions(a1, v11);
        if ( !v28 )
          return v11;
        v29 = (_BYTE *)skip_section(
                         v28,
                         (((unsigned __int8)*(_WORD *)(a1 + 8) << 8) | HIBYTE(*(unsigned __int16 *)(a1 + 8)))
                       + (((unsigned __int8)*(_WORD *)(a1 + 6) << 8) | HIBYTE(*(unsigned __int16 *)(a1 + 6)))
                       + (((unsigned __int8)*(_WORD *)(a1 + 10) << 8) | HIBYTE(*(unsigned __int16 *)(a1 + 10))),
                         a1,
                         v11);
        if ( !v29 )
          return v11;
        v30 = v29 + 9;
        v29[6] = v24;
        v29[2] = 41;
        v29[3] = HIBYTE(v9);
        v29[4] = v9;
        v29[5] = HIBYTE(v24);
        v29[7] = HIBYTE(v13);
        v29[8] = v13;
        v29[9] = BYTE1(v17);
        *v29 = 0;
        v29[1] = 0;
        v31 = v29 + 11;
        v29[10] = v17;
        if ( v25 )
        {
          memcpy(v29 + 11, v25, v17);
          free(v25);
          v19 = &v31[v17];
        }
        else
        {
          v19 = v29 + 11;
        }
        v18 = v30;
        *(_WORD *)(a1 + 10) = ((unsigned __int8)(HIBYTE(*(_WORD *)(a1 + 10)) + 1) << 8) | ((unsigned __int16)((((unsigned __int8)*(_WORD *)(a1 + 10) << 8) | HIBYTE(*(_WORD *)(a1 + 10))) + 1) >> 8);
        v27 = (__int16)v31;
        goto LABEL_31;
      }
    }
  }
  return v11;
}
